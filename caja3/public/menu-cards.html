<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Men√∫ La Ruta 11 - Tarjetas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: Arial, sans-serif; 
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    #menu-container { padding: 4px; max-width: 100%; margin: 0 auto; }
    
    .products-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; }
    
    .product-card { 
      background: white; 
      border: 1px solid #e5e5e5; 
      border-radius: 8px; 
      overflow: hidden;
      display: flex;
      flex-direction: column;
      page-break-inside: avoid;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .product-card:hover { transform: scale(1.05); }
    

    
    .product-image { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
    .product-image-placeholder { width: 100%; aspect-ratio: 1/1; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: clamp(24px, 4vw, 48px); }
    
    .fullscreen-image-placeholder { width: 45%; height: 100%; max-height: 100%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 200px; flex-shrink: 0; }
    
    .product-content { padding: clamp(6px, 1.5vw, 12px); flex: 1; display: flex; flex-direction: column; min-height: 0; }
    .product-name { font-size: clamp(10px, 1.2vw, 14px); font-weight: bold; margin-bottom: clamp(3px, 0.8vw, 6px); line-height: 1.2; color: #ff6b00; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; }
    .product-description { font-size: clamp(7px, 0.85vw, 9px); color: #666; margin-bottom: clamp(4px, 1vw, 8px); line-height: 1.3; flex: 1; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical; min-height: 0; }
    .product-price { font-size: clamp(12px, 1.5vw, 18px); font-weight: bold; color: #059669; margin-top: auto; white-space: nowrap; }
    

    

    
    .loading { text-align: center; padding: 4px; color: #fff; }
    
    .fullscreen-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.95);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }
    
    .fullscreen-modal.active { display: flex; }
    
    .fullscreen-content {
      display: flex;
      width: 90vw;
      height: 90vh;
      max-height: 90vh;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
    }
    
    .fullscreen-image {
      width: 45%;
      height: 100%;
      max-height: 100%;
      object-fit: cover;
      flex-shrink: 0;
    }
    
    .fullscreen-details {
      width: 55%;
      padding: clamp(20px, 4vw, 60px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .fullscreen-category {
      font-size: clamp(18px, 2vw, 32px);
      color: #666;
      margin-bottom: clamp(8px, 1.5vh, 15px);
      font-weight: bold;
    }
    
    .fullscreen-name {
      font-size: clamp(28px, 4.5vw, 72px);
      font-weight: bold;
      color: #ff6b00;
      margin-bottom: clamp(15px, 2vh, 30px);
      line-height: 1.1;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    .fullscreen-description {
      font-size: clamp(16px, 2.5vw, 40px);
      color: #333;
      margin-bottom: clamp(20px, 2.5vh, 40px);
      line-height: 1.3;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    .fullscreen-price {
      font-size: clamp(36px, 5.5vw, 90px);
      font-weight: bold;
      color: #059669;
    }
    
    .close-fullscreen {
      position: absolute;
      top: clamp(10px, 2vh, 20px);
      right: clamp(10px, 2vw, 20px);
      font-size: clamp(30px, 4vw, 60px);
      color: #666;
      cursor: pointer;
      background: rgba(255,255,255,0.9);
      width: clamp(40px, 5vw, 80px);
      height: clamp(40px, 5vw, 80px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      z-index: 10;
    }
    
    .autoplay-controls {
      position: absolute;
      top: clamp(10px, 2vh, 20px);
      right: clamp(110px, 12vw, 120px);
      z-index: 10;
    }
    
    .autoplay-btn {
      font-size: clamp(30px, 4vw, 60px);
      cursor: pointer;
      background: rgba(255,255,255,0.9);
      width: clamp(40px, 5vw, 80px);
      height: clamp(40px, 5vw, 80px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      color: #ff6b00;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .fullscreen-content.animate { animation: slideIn 0.5s ease-out; }
  </style>
</head>
<body>
  <div id="menu-container">
    <div id="menu-content" class="loading">Cargando men√∫...</div>
  </div>
  
  <script>
    const categories = {
      2: { name: 'Sandwiches', emoji: 'ü•™' },
      3: { name: 'Hamburguesas', emoji: 'üçî' },
      4: { name: 'Completos', emoji: 'üå≠' },
      12: { name: 'Papas', emoji: 'üçü' },
      8: { name: 'Combos', emoji: 'üçΩÔ∏è' },
      11: { name: 'Bebidas', emoji: 'ü•§' },
      10: { name: 'Caf√© & T√©', emoji: '‚òï' }
    };
    
    async function loadMenu() {
      try {
        const response = await fetch('/api/get_productos.php');
        const products = await response.json();
        
        if (!Array.isArray(products)) {
          throw new Error('Formato de datos inv√°lido');
        }
        
        // Filtrar solo categor√≠as del men√∫ y productos activos
        const menuProducts = products.filter(p => {
          const catId = parseInt(p.category_id);
          const subcatId = parseInt(p.subcategory_id);
          return p.is_active == 1 && ([2, 3, 4, 8, 12].includes(catId) || (catId === 5 && subcatId === 9) || (catId === 5 && subcatId === 10) || (catId === 5 && subcatId === 11) || (catId === 5 && subcatId === 27) || (catId === 5 && subcatId === 28));
        });
        
        // Asignar categor√≠a a cada producto
        const allProducts = menuProducts.map(product => {
          const catId = parseInt(product.category_id);
          const subcatId = parseInt(product.subcategory_id);
          
          let categoryKey = catId;
          if (catId === 12 || (catId === 5 && subcatId === 9)) {
            categoryKey = 12;
          } else if (catId === 5 && (subcatId === 10 || subcatId === 11)) {
            categoryKey = 11;
          } else if (catId === 5 && (subcatId === 27 || subcatId === 28)) {
            categoryKey = 10;
          }
          
          return {
            ...product,
            categoryKey,
            categoryName: categories[categoryKey]?.name || 'Otros'
          };
        });
        
        // Ordenar: Hamburguesas(3) ‚Üí Sandwiches(2) ‚Üí Completos(4) ‚Üí Papas(12) ‚Üí Combos(8) ‚Üí Bebidas(11) ‚Üí Caf√© & T√©(10)
        const order = [3, 2, 4, 12, 8, 11, 10];
        allProducts.sort((a, b) => {
          const indexA = order.indexOf(a.categoryKey);
          const indexB = order.indexOf(b.categoryKey);
          return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);
        });
        
        // Renderizar
        let html = `
          <div class="products-grid">
            ${allProducts.map(product => `
              <div class="product-card">
                ${product.image_url ? 
                  `<img src="${product.image_url}" alt="${product.name}" class="product-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                   <div class="product-image-placeholder" style="display:none;">üçΩÔ∏è</div>` :
                  `<div class="product-image-placeholder">üçΩÔ∏è</div>`
                }
                <div class="product-content">
                  <div class="product-name">${product.name}</div>
                  ${product.description ? `<div class="product-description">${product.description}</div>` : ''}
                  <div class="product-price">$${new Intl.NumberFormat('es-CL').format(product.price)}</div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
        
        document.getElementById('menu-content').innerHTML = html || '<p style="text-align:center;color:#666;">No hay productos disponibles</p>';
        
        // Guardar productos globalmente
        allProductsGlobal = allProducts;
        
        // Agregar event listeners para fullscreen
        document.querySelectorAll('.product-card').forEach((card, index) => {
          card.addEventListener('click', () => openFullscreen(allProducts[index]));
        });
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('menu-content').innerHTML = '<p style="text-align:center;color:#ef4444;">Error al cargar el men√∫</p>';
      }
    }
    
    function downloadPDF() {
      const element = document.getElementById('menu-container');
      const opt = {
        margin: 10,
        filename: 'menu-laruta11-tarjetas.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
      };
      
      html2pdf().set(opt).from(element).save();
    }
    
    let allProductsGlobal = [];
    let currentIndex = 0;
    let autoplayInterval = null;
    let isPlaying = false;
    
    function openFullscreen(product) {
      currentIndex = allProductsGlobal.findIndex(p => p.id === product.id);
      showProduct(product);
    }
    
    function showProduct(product) {
      let modal = document.querySelector('.fullscreen-modal');
      if (!modal) {
        modal = document.createElement('div');
        modal.className = 'fullscreen-modal active';
        document.body.appendChild(modal);
      }
      
      modal.innerHTML = `
        <div class="fullscreen-content animate">
          <div class="close-fullscreen" onclick="closeFullscreen()">√ó</div>
          ${product.image_url ? 
            `<img src="${product.image_url}" class="fullscreen-image">` :
            `<div class="fullscreen-image" style="background:#f0f0f0;display:flex;align-items:center;justify-content:center;font-size:200px;">üçΩÔ∏è</div>`
          }
          <div class="fullscreen-details">
            <div class="fullscreen-category">${product.categoryName}</div>
            <div class="fullscreen-name">${product.name}</div>
            ${product.description ? `<div class="fullscreen-description">${product.description}</div>` : ''}
            <div class="fullscreen-price">$${new Intl.NumberFormat('es-CL').format(product.price)}</div>
          </div>
          <div class="autoplay-controls">
            <button class="autoplay-btn" onclick="toggleAutoplay()" id="playPauseBtn">‚ñ∂</button>
          </div>
        </div>
      `;
    }
    
    function closeFullscreen() {
      const modal = document.querySelector('.fullscreen-modal');
      if (modal) modal.remove();
      if (autoplayInterval) clearInterval(autoplayInterval);
      isPlaying = false;
    }
    
    function nextProduct() {
      currentIndex = (currentIndex + 1) % allProductsGlobal.length;
      showProduct(allProductsGlobal[currentIndex]);
      updatePlayButton();
    }
    
    function toggleAutoplay() {
      isPlaying = !isPlaying;
      if (isPlaying) {
        autoplayInterval = setInterval(nextProduct, 5000);
      } else {
        clearInterval(autoplayInterval);
      }
      updatePlayButton();
    }
    
    function updatePlayButton() {
      const btn = document.getElementById('playPauseBtn');
      if (btn) btn.textContent = isPlaying ? '‚è∏' : '‚ñ∂';
    }
    
    loadMenu();
  </script>
</body>
</html>
