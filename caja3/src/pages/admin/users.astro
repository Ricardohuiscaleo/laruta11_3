---
---
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Usuarios - Admin La Ruta 11</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f8fafc; }
    .header { background: white; padding: 1.5rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .back-btn { background: #667eea; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; text-decoration: none; }
    .container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
    .card-header { padding: 1.5rem 2rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
    .search { position: relative; width: 300px; }
    .search input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid #d1d5db; border-radius: 8px; }
    .search-icon { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: #6b7280; }
    .table { width: 100%; border-collapse: collapse; }
    .table th { text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; }
    .table td { padding: 1rem; border-bottom: 1px solid #f3f4f6; }
    .table tr:hover { background: #f9fafb; }
    .btn { padding: 0.5rem 1rem; border-radius: 6px; border: none; font-size: 0.875rem; cursor: pointer; text-decoration: none; display: inline-block; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-secondary { background: #f3f4f6; color: #374151; }
    .status { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
    .status-active { background: #dcfce7; color: #166534; }
    .status-inactive { background: #fef2f2; color: #dc2626; }
  </style>
</head>
<body>
  <div class="header">
    <h1>üë• Gesti√≥n de Usuarios</h1>
    <a href="/admin" class="back-btn">‚Üê Volver al Admin</a>
  </div>
  
  <div class="container">
    <div class="card">
      <div class="card-header">
        <h2>Lista de Usuarios</h2>
        <div class="search">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          <input type="text" placeholder="Buscar usuarios..." onkeyup="filterUsers(this.value)">
        </div>
      </div>
      
      <table class="table" id="usersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Email</th>
            <th>Tel√©fono</th>
            <th>Registro</th>
            <th>Pedidos</th>
            <th>Total Gastado</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="9" style="text-align: center; padding: 2rem; color: #6b7280;">Cargando usuarios...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <script>
    function loadUsers() {
      fetch('http://localhost/ruta11caja/api/users/get_users.php')
        .then(r => r.json())
        .then(data => {
          console.log('API Response:', data);
          const tbody = document.querySelector('#usersTable tbody');
          if (!tbody) return;
          if (data.success && data.data && data.data.length > 0) {
            tbody.innerHTML = data.data.map(user => 
              '<tr>' +
                '<td>' + user.id + '</td>' +
                '<td>' +
                  '<div style="font-weight: 600;">' + (user.name || 'Sin nombre') + '</div>' +
                  '<div style="font-size: 0.75rem; color: #6b7280;">' + (user.city || 'Sin ciudad') + '</div>' +
                '</td>' +
                '<td>' + (user.email || '-') + '</td>' +
                '<td>' + (user.phone || '-') + '</td>' +
                '<td>' + new Date(user.registration_date).toLocaleDateString('es-CL') + '</td>' +
                '<td><span style="font-weight: 600; color: #3b82f6;">' + (user.total_orders || 0) + '</span></td>' +
                '<td><span style="font-weight: 600; color: #059669;">$' + (user.total_spent || 0).toLocaleString('es-CL') + '</span></td>' +
                '<td><span class="status ' + (user.is_active ? 'status-active' : 'status-inactive') + '">' + (user.is_active ? 'Activo' : 'Inactivo') + '</span></td>' +
                '<td><button class="btn btn-secondary" onclick="viewUser(' + user.id + ')">Ver Detalle</button></td>' +
              '</tr>'
            ).join('');
          } else {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 2rem; color: #6b7280;">No hay usuarios registrados</td></tr>';
          }
        })
        .catch(err => {
          console.error('Error:', err);
          const tbody = document.querySelector('#usersTable tbody');
          if (tbody) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 2rem; color: #ef4444;">Error al cargar usuarios</td></tr>';
          }
        });
    }
    
    function viewUser(userId) {
      alert('Ver detalles del usuario ID: ' + userId);
    }
    
    function filterUsers(searchTerm) {
      const rows = document.querySelectorAll('#usersTable tbody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        const shouldShow = text.includes(searchTerm.toLowerCase());
        (row as HTMLElement).style.display = shouldShow ? '' : 'none';
      });
    }
    
    document.addEventListener('DOMContentLoaded', loadUsers);
  </script>
</body>
</html>