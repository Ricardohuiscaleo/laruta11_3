<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“§ Gestor de Correos - La Ruta 11</title>
    <link rel="stylesheet" href="/styles/global.css">
</head>
<body>
<div class="min-h-screen p-6" style="background-color: #f3f4f6;">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“§ Gestor de Correos Gmail</h1>
                <p class="text-gray-600">EnvÃ­o de emails automatizados desde saboresdelaruta11@gmail.com</p>
            </div>

            <!-- Gmail Status -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ”‘ Estado de Gmail API</h2>
                <div id="gmailStatus" class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                    <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                    <span class="text-gray-700">Verificando...</span>
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="checkGmailStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                        ğŸ” Verificar Estado
                    </button>
                    <a href="/api/gmail/auth.php" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium inline-block">
                        ğŸ” Autorizar Gmail
                    </a>
                </div>
            </div>

            <!-- Send Email Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“¤ Enviar Email de Prueba</h2>
                <form id="emailForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Para (Email)</label>
                        <input type="email" id="emailTo" required 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="destinatario@example.com">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Asunto</label>
                        <input type="text" id="emailSubject" required 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Asunto del correo">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Mensaje</label>
                        <textarea id="emailBody" rows="6" required 
                                  class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  placeholder="Escribe tu mensaje aquÃ­..."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-lg">
                        ğŸ“§ Enviar Email
                    </button>
                </form>
            </div>

            <!-- Status Message -->
            <div id="statusMessage" class="hidden mt-6 p-4 rounded-lg"></div>
        </div>
    </div>
</body>
</html>

<script>
        // Check Gmail status on load
        window.addEventListener('DOMContentLoaded', checkGmailStatus);

        async function checkGmailStatus() {
            const statusDiv = document.getElementById('gmailStatus');
            statusDiv.innerHTML = '<div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div><span class="text-gray-700">Verificando...</span>';
            
            try {
                const response = await fetch('/api/gmail/send_email.php?to=test@test.com&subject=test&body=test');
                const result = await response.json();
                
                if (result.success || result.error?.includes('Token')) {
                    // Token exists
                    statusDiv.innerHTML = '<div class="w-3 h-3 bg-green-500 rounded-full"></div><span class="text-green-700 font-medium">âœ… Gmail API configurado correctamente</span>';
                } else {
                    statusDiv.innerHTML = '<div class="w-3 h-3 bg-red-500 rounded-full"></div><span class="text-red-700 font-medium">âŒ Gmail API no configurado</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="w-3 h-3 bg-red-500 rounded-full"></div><span class="text-red-700 font-medium">âŒ Error de conexiÃ³n</span>';
            }
        }

        document.getElementById('emailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const to = document.getElementById('emailTo').value;
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            
            showStatus('Enviando email...', 'info');
            
            try {
                const formData = new FormData();
                formData.append('to', to);
                formData.append('subject', subject);
                formData.append('body', body);
                
                const response = await fetch('/api/gmail/send_email.php', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('âœ… Email enviado correctamente a ' + to, 'success');
                    document.getElementById('emailForm').reset();
                } else {
                    showStatus('âŒ Error: ' + result.error, 'error');
                }
            } catch (error) {
                showStatus('âŒ Error de conexiÃ³n', 'error');
            }
        });

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            const colors = {
                success: 'bg-green-100 border-green-500 text-green-700',
                error: 'bg-red-100 border-red-500 text-red-700',
                info: 'bg-blue-100 border-blue-500 text-blue-700'
            };
            
            statusDiv.className = `mt-6 p-4 rounded-lg border-l-4 ${colors[type]}`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 5000);
            }
        }
</script>

<style>
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    .bg-white { background-color: white; }
    .rounded-lg { border-radius: 0.5rem; }
    .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .p-6 { padding: 1.5rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .font-bold { font-weight: 700; }
    .font-medium { font-weight: 500; }
    .text-gray-800 { color: #1f2937; }
    .text-gray-700 { color: #374151; }
    .text-gray-600 { color: #4b5563; }
    .text-green-700 { color: #15803d; }
    .text-red-700 { color: #b91c1c; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .w-3 { width: 0.75rem; }
    .h-3 { height: 0.75rem; }
    .w-full { width: 100%; }
    .max-w-4xl { max-width: 56rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .rounded-full { border-radius: 9999px; }
    .bg-yellow-500 { background-color: #eab308; }
    .bg-green-500 { background-color: #22c55e; }
    .bg-red-500 { background-color: #ef4444; }
    .bg-gray-50 { background-color: #f9fafb; }
    .bg-blue-600 { background-color: #2563eb; }
    .bg-blue-700 { background-color: #1d4ed8; }
    .bg-green-600 { background-color: #16a34a; }
    .bg-green-700 { background-color: #15803d; }
    .bg-orange-600 { background-color: #ea580c; }
    .bg-orange-700 { background-color: #c2410c; }
    .text-white { color: white; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .border { border-width: 1px; }
    .border-gray-300 { border-color: #d1d5db; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .block { display: block; }
    .inline-block { display: inline-block; }
    .hidden { display: none; }
    button, input, textarea { font-family: inherit; }
    button { cursor: pointer; border: none; }
    button:hover { opacity: 0.9; }
    input, textarea { outline: none; }
    input:focus, textarea:focus { ring: 2px solid #2563eb; }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
</style>
