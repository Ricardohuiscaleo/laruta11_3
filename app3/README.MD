# La Ruta 11 - Sistema de Gesti√≥n de Restaurante

## üöÄ Configuraci√≥n y Ejecuci√≥n del Proyecto

### Requisitos Previos
- Node.js (versi√≥n 18 o superior)
- Visual Studio Code o editor preferido
- Servidor web con PHP y MySQL

### Instalaci√≥n

1. **Clonar/Descargar el proyecto**
```bash
git clone [repositorio]
cd ruta11app
```

2. **Instalar dependencias**
```bash
npm install
```

3. **Configurar base de datos**
- Importar estructura de BD desde `api/setup_tables.php`
- Configurar credenciales en `api/config.php`

4. **Iniciar desarrollo**
```bash
npm run dev
```

5. **Acceder a la aplicaci√≥n**
- Frontend: `http://localhost:4321`
- Admin: `http://localhost:4321/admin`
- Caja: `http://localhost:4321/caja`

# Sistema de Combos - Plan de Implementaci√≥n

## üìã Resumen del Requerimiento

Implementar un sistema completo de combos que permita:
- Gestionar combos como conjunto de productos (completo + papas + bebida)
- Seleccionar bebidas espec√≠ficas en el carrito (APP y CAJA)
- Descuento autom√°tico de inventario por ingredientes y productos
- C√°lculo autom√°tico de costos basado en recetas e ingredientes

## üéØ Objetivos

### 1. **Gesti√≥n de Combos en Admin**
- Agregar productos a combos considerando solo su costo
- Especial atenci√≥n a bebidas en combos
- Recetas de combos con ingredientes e insumos (excepto bebidas)

### 2. **Experiencia de Usuario (APP/CAJA)**
- Selecci√≥n de bebidas espec√≠ficas para combos
- Descuento autom√°tico de inventario al comprar
- Vista de carrito mejorada para combos

### 3. **Control de Inventario**
- Descuento de ingredientes seg√∫n receta del combo
- Descuento de productos espec√≠ficos (bebidas seleccionadas)
- Ajuste autom√°tico de stock de productos basado en ingredientes

## üèóÔ∏è Arquitectura del Sistema

### **Base de Datos**

#### Nuevas Tablas Necesarias:
```sql
-- Tabla principal de combos
CREATE TABLE combos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    image_url VARCHAR(500),
    category_id INT DEFAULT 8,
    active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id)
);

-- Productos que componen cada combo
CREATE TABLE combo_items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    combo_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT DEFAULT 1,
    is_selectable TINYINT(1) DEFAULT 0,
    selection_group VARCHAR(50),
    FOREIGN KEY (combo_id) REFERENCES combos(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES productos(id)
);

-- Opciones seleccionables para grupos (ej: bebidas)
CREATE TABLE combo_selections (
    id INT AUTO_INCREMENT PRIMARY KEY,
    combo_id INT NOT NULL,
    selection_group VARCHAR(50) NOT NULL,
    product_id INT NOT NULL,
    additional_price DECIMAL(10,2) DEFAULT 0,
    FOREIGN KEY (combo_id) REFERENCES combos(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES productos(id)
);
```

## üìù Plan de Implementaci√≥n

### **Fase 1: Backend - Gesti√≥n de Combos**

#### 1.1 APIs para Combos
- `api/setup_combo_tables.php` - Configurar tablas
- `api/get_combos.php` - Obtener combos con productos
- `api/save_combo.php` - Crear/editar combos
- `api/delete_combo.php` - Eliminar combos
- Modificaci√≥n en `api/process_sale_inventory.php` - Manejo de inventario

#### 1.2 Modificar Editor de Productos
- Detectar si `category_id = 8` (Combos)
- Mostrar secci√≥n "Gesti√≥n de Combo" 
- Permitir agregar productos con costo espec√≠fico
- Marcar bebidas como seleccionables

### **Fase 2: Frontend Admin - Editor de Combos**

#### 2.1 Interfaz de Gesti√≥n
- `src/pages/admin/combos.astro` - Gesti√≥n de combos (admin)
- Lista de productos actuales
- Bot√≥n "Agregar Producto"
- Checkbox "Es seleccionable" para bebidas
- Campo costo espec√≠fico

#### 2.2 Modal de Selecci√≥n de Productos
- Lista de todos los productos disponibles
- Filtro por categor√≠a (especial para bebidas)
- Campo para cantidad y costo espec√≠fico
- Checkbox para marcar como seleccionable

### **Fase 3: Frontend Usuario - Carrito de Combos**

#### 3.1 Detecci√≥n de Combos en APP/CAJA
- Modificaci√≥n en `src/pages/caja/index.astro` - Selector de combos
- Modificaci√≥n en `src/pages/index.astro` - Integraci√≥n en app principal
- Modal de personalizaci√≥n
- Productos fijos del combo
- Selecci√≥n de bebidas disponibles
- Confirmaci√≥n de selecci√≥n

#### 3.2 Vista de Carrito Mejorada
- Mostrar combo como item principal
- Listar productos incluidos
- Destacar selecciones personalizables
- Precio total del combo

### **Fase 4: Sistema de Inventario**

#### 4.1 Descuento al Procesar Venta
- Descontar ingredientes seg√∫n receta del combo
- Descontar productos seleccionados (bebidas)
- Integraci√≥n completa con `process_sale_inventory.php`

#### 4.2 C√°lculo de Stock Disponible
- Considerar ingredientes disponibles para combos
- Considerar productos seleccionables disponibles
- Mostrar stock real del combo

## üîß Archivos a Modificar/Crear

### **Nuevos Archivos**
1. `api/setup_combo_tables.php`
2. `api/get_combos.php`
3. `api/save_combo.php`
4. `api/delete_combo.php`
5. `src/pages/admin/combos.astro`

### **Archivos a Modificar**
1. `src/pages/admin/edit-product.astro` - Agregar gesti√≥n de combos
2. `src/pages/caja/index.astro` - Integrar selector de combos
3. `src/pages/index.astro` - Integrar selector de combos en APP
4. `api/process_sale_inventory.php` - Manejar inventario de combos
5. `api/get_productos.php` - Incluir informaci√≥n de combos

## üìä Flujo de Datos

### **Creaci√≥n de Combo (Admin)**
1. Usuario selecciona categor√≠a "Combos"
2. Sistema detecta `is_combo = true`
3. Muestra interfaz de gesti√≥n de combo
4. Admin agrega productos con costos espec√≠ficos
5. Marca bebidas como seleccionables
6. Sistema calcula costo total del combo

### **Compra de Combo (Usuario)**
1. Usuario selecciona combo en APP/CAJA
2. Sistema muestra productos incluidos
3. Usuario selecciona bebida espec√≠fica
4. Se agrega al carrito con selecciones
5. Al pagar, se descuenta inventario:
   - Ingredientes seg√∫n receta del combo
   - Productos seleccionados espec√≠ficos

### **Control de Stock**
1. Stock de combo = MIN(stock_ingredientes, stock_productos_seleccionables)
2. Al vender combo:
   - Descontar ingredientes de receta
   - Descontar productos seleccionados
   - Recalcular stock disponible

## ‚ö° Implementaci√≥n Prioritaria

### **Sprint 1 (Backend)**
- [ ] Crear tablas de base de datos
- [ ] APIs b√°sicas de gesti√≥n de combos
- [ ] Modificar process_sale_inventory.php

### **Sprint 2 (Admin)**
- [ ] Modificar edit-product.astro
- [ ] Crear interfaz de gesti√≥n de combos
- [ ] Sistema de c√°lculo de costos

### **Sprint 3 (Frontend Usuario)**
- [ ] Integrar selector en CAJA
- [ ] Integrar selector en APP
- [ ] Vista de carrito mejorada

### **Sprint 4 (Testing & Optimizaci√≥n)**
- [ ] Pruebas de inventario
- [ ] Optimizaci√≥n de performance
- [ ] Documentaci√≥n final

## üéØ Casos de Uso Ejemplo

### **Combo Completo Tradicional**
- **Productos**: Completo Tradicional + Papas Medianas + Bebida (seleccionable)
- **Receta**: Ingredientes del completo + ingredientes de papas
- **Selecci√≥n**: Usuario elige entre Coca-Cola, Sprite, Fanta
- **Inventario**: Descuenta ingredientes + bebida espec√≠fica seleccionada

### **Combo Hamburguesa Especial**
- **Productos**: Hamburguesa + Papas + Bebida + Salsa (seleccionable)
- **Receta**: Ingredientes de hamburguesa + papas
- **Selecci√≥n**: Usuario elige bebida y tipo de salsa
- **Inventario**: Descuenta seg√∫n receta + productos seleccionados

## üìà Beneficios Esperados

1. **Gesti√≥n Simplificada**: Admin puede crear combos f√°cilmente
2. **Experiencia Mejorada**: Usuarios pueden personalizar combos
3. **Control Preciso**: Inventario se maneja autom√°ticamente
4. **Costos Exactos**: C√°lculo autom√°tico basado en ingredientes reales
5. **Escalabilidad**: Sistema flexible para nuevos tipos de combos

---

**Nota**: Este plan se implementar√° de forma incremental, asegurando que cada fase funcione correctamente antes de proceder a la siguiente.

## Deployment en Hostinger (PWA)

### Preparar para Producci√≥n

1. Construye el proyecto:
```bash
npm run build
```

2. Sube la carpeta `dist` completa a tu hosting Hostinger via FTP/cPanel

3. Configura tu dominio para apuntar a la carpeta donde subiste los archivos

### Backend PHP/MySQL

1. Crea una carpeta `api` en tu hosting
2. Configura la conexi√≥n a MySQL en tus archivos PHP
3. Actualiza la URL en `components/api.js` con tu dominio real

### Caracter√≠sticas PWA Incluidas

- ‚úÖ Optimizado para m√≥viles
- ‚úÖ Carga r√°pida
- ‚úÖ Funciona offline (b√°sico)
- ‚úÖ Instalable como app
- ‚úÖ Responsive design
- ‚úÖ Sistema de Control de Calidad integrado
- ‚úÖ Gesti√≥n de sesiones persistentes con cookies
- ‚úÖ Analytics avanzado con tracking de usuarios

### Cache Busting

El sistema implementa t√©cnicas de "Cache Busting" para garantizar que los datos mostrados siempre est√©n actualizados en tiempo real:

- ‚úÖ **Timestamps √∫nicos** en todas las llamadas API
- ‚úÖ **Headers anti-cach√©** en respuestas del servidor
- ‚úÖ **Bot√≥n refresh** que limpia cach√© completo
- ‚úÖ **Par√°metros din√°micos** para evitar cach√© del navegador
- ‚úÖ **Versionado autom√°tico** de assets est√°ticos

## Estructura Actual del Proyecto

### Frontend (React/Astro)
- Aplicaci√≥n de men√∫ con tarjetas de productos
- Loader inicial con logo
- Carrito de compras funcional
- Modales para detalles de productos
- Navegaci√≥n por categor√≠as
- Im√°genes locales para productos principales
- **Sistema de Control de Calidad** (`/admin/calidad`)
  - Checklists para Maestro Planchero y Cajero
  - Respuestas S√≠/No con observaciones
  - Subida de fotos evidencia comprimidas
  - C√°lculo autom√°tico de scores de calidad

### Backend PHP/MySQL

**Configuraci√≥n de Base de Datos** (`config.php`):
- **Base de Datos Principal (APP)**: `u958525313_app`
- **Usuario**: `u958525313_app`
- **Contrase√±a**: `wEzho0-hujzoz-cevzin`
- **Servidor**: localhost
- API Gemini integrada
- B√∫squeda autom√°tica de config.php hasta 5 niveles

**API Endpoints Disponibles** (`api/` - 80+ archivos PHP):

**Productos:**
- `get_productos.php` - Obtener productos
- `add_producto.php` - Agregar producto
- `update_producto.php` - Actualizar producto
- `create_producto.php` - Crear producto

**Ingredientes y Recetas:**
- `get_ingredientes.php` - Obtener ingredientes
- `save_ingrediente.php` - Guardar ingrediente
- `get_recetas.php` - Obtener recetas
- `update_receta.php` - Actualizar receta

**Categor√≠as:**
- `get_categories.php` - Obtener categor√≠as
- `save_category.php` - Guardar categor√≠a
- `categorias_hardcoded.php` - Categor√≠as predefinidas

**Proyecciones Financieras:**
- `proyeccion.php` - Proyecci√≥n b√°sica
- `proyeccion_v2.php` - Proyecci√≥n v2
- `proyeccion_v3.php` - Proyecci√≥n v3
- `get_proyeccion.php` - Obtener proyecci√≥n
- `save_proyeccion.php` - Guardar proyecci√≥n

**Ventas:**
- `registrar_venta.php` - Registrar venta
- `ventas_update.php` - Actualizar ventas
- `ventas_get_all.php` - Obtener todas las ventas

**Dashboard y KPIs:**
- `get_dashboard_kpis.php` - Obtener KPIs
- `setup_dashboard_tables.php` - Configurar tablas

**Testing y Debug:**
- `test_api.php` - Probar API
- `test_connection.php` - Probar conexi√≥n
- `debug_db_connection.php` - Debug conexi√≥n DB

**Control de Calidad:**
- `get_questions.php` - Obtener preguntas por rol desde `quality_questions`
- `save_checklist.php` - Guardar checklists en `quality_checklists`
- `get_quality_score.php` - Obtener promedio de calidad para dashboard
- Tabla `quality_questions` - 20 preguntas (14 planchero + 6 cajero)
- Tabla `quality_checklists` - Almacena respuestas y scores
- Compresi√≥n autom√°tica de im√°genes evidencia
- Integraci√≥n con sistema de subida AWS existente

**Concurso/Torneo:**
- `get_concurso_live.php` - Obtener estado actual del torneo
- `update_concurso_state.php` - Actualizar estado del torneo
- Sistema de torneo eliminatorio 8 participantes
- Control manual de progresi√≥n de etapas
- Vista en tiempo real con actualizaci√≥n cada 1 segundo

**Setup y Configuraci√≥n:**
- `setup_tables.php` - Configurar tablas
- `check_config.php` - Verificar configuraci√≥n
- `save_config.php` - Guardar configuraci√≥n

### Im√°genes de Productos (`public/`)
- `icon.png` - Logo de la aplicaci√≥n
- `Completo-italiano.png` - Completo Tradicional
- `completo-talquino.png` - Completo Talquino
- `salchi-papas.png` - Salchipapas
- `papas-ruta11.png` - Papas Ruta 11
- `toma-provoleta.png` - Tomahawk Provoleta
- `tomahawk-full.png` - Tomahawk Full Ruta 11

## Sistema de Control de Calidad

### Funcionalidades
- **Checklists Diarios**: Maestro Planchero (14 preguntas) y Cajero (6 preguntas)
- **Secciones Organizadas**: Pre-Servicio, Durante Servicio, Post-Servicio
- **Respuestas Estructuradas**: S√≠/No + observaciones de texto libre
- **Evidencia Fotogr√°fica**: Compresi√≥n autom√°tica y subida a AWS S3
- **Scoring Autom√°tico**: C√°lculo de porcentaje de calidad por rol
- **Dashboard Integration**: Promedio de calidad visible en dashboard principal
- **Hist√≥rico**: Un checklist por d√≠a por rol (actualizable)
- **Base de Datos**: Usa `u958525313_app` (no Calcularuta11)

### Base de Datos

**Tabla de Preguntas:**
```sql
CREATE TABLE quality_questions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    role ENUM('planchero', 'cajero') NOT NULL,
    question TEXT NOT NULL,
    requires_photo TINYINT(1) DEFAULT 0,
    order_index INT NOT NULL,
    active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Tabla de Respuestas:**
```sql
CREATE TABLE quality_checklists (
    id INT AUTO_INCREMENT PRIMARY KEY,
    role ENUM('planchero', 'cajero') NOT NULL,
    checklist_date DATE NOT NULL,
    responses JSON NOT NULL,
    total_questions INT NOT NULL,
    passed_questions INT NOT NULL,
    score_percentage DECIMAL(5,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_role_date (role, checklist_date)
);
```

### Acceso y Caracter√≠sticas
- **URL**: `/admin/calidad` (integrado en SaaS admin)
- **Navegaci√≥n**: Bot√≥n "Control Calidad" en men√∫ admin
- **Responsive**: Optimizado para m√≥viles y tablets
- **Acordeones**: Secciones colapsables para mejor UX
- **Progreso Visual**: Barra de progreso en tiempo real
- **Persistencia**: LocalStorage guarda progreso autom√°ticamente
- **Dashboard**: M√©trica "Calidad Promedio" en dashboard principal
- **API Endpoints**: 3 APIs dedicados para funcionalidad completa

## Sistema de Concurso/Torneo EN VIVO

### Funcionalidades Principales
- **Torneo Eliminatorio**: 8 participantes ‚Üí Cuartos ‚Üí Semifinales ‚Üí Final ‚Üí Campe√≥n
- **Admin Panel** (`/concurso/admin`): Control total del torneo
- **Vista EN VIVO** (`/concurso/live`): Transmisi√≥n en tiempo real
- **Control Manual**: Admin decide cu√°ndo avanzar cada etapa
- **Actualizaci√≥n Tiempo Real**: Datos se actualizan cada 1 segundo

### Panel de Administraci√≥n
- **Participantes**: 8 concursantes con seeds del 1-8
- **Enfrentamientos**: Selecci√≥n manual de ganadores por click
- **Estados Visuales**: üü¢ Activo, üî¥ Eliminado, üëë Campe√≥n
- **Control de Etapas**: Bot√≥n "‚û°Ô∏è Avanzar a Siguiente Etapa"
- **Botones de Control**:
  - ‚ñ∂Ô∏è Iniciar Torneo
  - üîÑ Reiniciar Todo
  - ‚û°Ô∏è Avanzar a Siguiente Etapa (manual)

### Vista EN VIVO (P√∫blico)
- **Formato Piramidal**: Campe√≥n ‚Üí Final ‚Üí Semifinales ‚Üí Cuartos
- **Layout Responsivo**: Adaptado para pantallas completas
- **Animaciones Suaves**: Transiciones fluidas en todos los cambios
- **Indicadores Visuales**:
  - üü¢ Fondo verde + escala para ganadores
  - üî¥ "EN VIVO" para matches activos
  - üè∑Ô∏è Tag "GANADOR" amarillo
  - üëë Corona animada para campe√≥n
- **Nombres de Pila**: Solo primer nombre para mejor legibilidad
- **Placeholders**: "Sin foto" en espacios de im√°genes 4:5

### API Endpoints del Concurso
- `get_concurso_live.php` - Obtener estado actual del torneo
- `update_concurso_state.php` - Actualizar estado del torneo

### Caracter√≠sticas T√©cnicas
- **Actualizaci√≥n Autom√°tica**: Polling cada 1000ms (tiempo real)
- **Cache Busting**: Timestamps √∫nicos para datos frescos
- **Responsive Design**: Clamps y viewport units para escalabilidad
- **Animaciones CSS**: Keyframes para efectos visuales
- **Estado Persistente**: Datos guardados en base de datos
- **Control Manual**: Admin tiene control total sobre progresi√≥n

### Flujo del Torneo
1. **Preparaci√≥n**: Admin configura participantes
2. **Cuartos de Final**: 8 ‚Üí 4 participantes
3. **Control Manual**: Admin hace click "Avanzar a Siguiente Etapa"
4. **Semifinales**: 4 ‚Üí 2 participantes
5. **Control Manual**: Admin hace click "Avanzar a Siguiente Etapa"
6. **Final**: 2 ‚Üí 1 participante
7. **Campe√≥n**: Se declara autom√°ticamente

### URLs del Sistema
- **Admin**: `/concurso/admin` - Panel de control
- **Live**: `/concurso/live` - Vista p√∫blica en tiempo real

## Sistema de Niveles, Premios y Cupones

### Funcionalidades Principales
- **Sistema de Puntos**: $10 gastados = 1 punto, 1.000 puntos = 1 sello
- **3 Niveles de Recompensa**: Bronze, Silver, Gold (cada uno con 6 sellos)
- **Cashback Autom√°tico**: Se genera al completar cada nivel (6 sellos)
- **Cupones Canjeables**: Delivery Gratis (2 sellos) y Papas + Bebida (4 sellos)
- **Wallet Integrado**: Saldo de cashback visible en checkout

### Sistema de Niveles

**Nivel Bronze** ü•â
- 6 sellos ($60.000 gastados)
- Cashback: $6.000 (autom√°tico)
- Valor por sello: $1.000

**Nivel Silver** ü•à
- 6 sellos adicionales ($120.000 totales)
- Cashback: $12.000 (autom√°tico)
- Valor por sello: $2.000

**Nivel Gold** ü•á
- 6 sellos adicionales ($180.000 totales)
- Cashback: $18.000 (autom√°tico)
- Valor por sello: $3.000

### Recompensas Canjeables

**1. Delivery Gratis** (2 sellos)
- Se aplica en checkout
- Descuenta costo de delivery
- Cup√≥n se crea al aplicar en checkout

**2. Papas + Bebida Gratis** (4 sellos)
- Usuario elige papas (category 12/subcategory 57)
- Usuario elige bebida (14 opciones disponibles)
- Productos se agregan gratis al carrito
- Cup√≥n se crea al aplicar en checkout

### Base de Datos

**Tabla: user_coupons** ‚úÖ
```sql
CREATE TABLE user_coupons (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    coupon_type ENUM('delivery_free', 'papas_bebida') NOT NULL,
    status ENUM('available', 'used') DEFAULT 'available',
    stamps_used INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    used_at TIMESTAMP NULL,
    order_id VARCHAR(50) NULL,
    FOREIGN KEY (user_id) REFERENCES usuarios(id)
);
```

**Tabla: user_wallet** ‚úÖ
```sql
CREATE TABLE user_wallet (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL UNIQUE,
    balance DECIMAL(10,2) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES usuarios(id)
);
```

**Tabla: wallet_transactions** ‚úÖ
```sql
CREATE TABLE wallet_transactions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    type ENUM('credit', 'debit') NOT NULL,
    description VARCHAR(255),
    order_id VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES usuarios(id)
);
```

### API Endpoints

**Sistema de Cupones** (`/api/coupons/`):
- `create_coupon.php` - Crear cup√≥n al canjear recompensa
- `get_user_coupons.php` - Obtener cupones disponibles/usados
- `use_coupon.php` - Marcar cup√≥n como usado

**Sistema de Wallet**:
- `get_wallet_balance.php` - Obtener saldo de cashback
- `use_wallet_balance.php` - Usar cashback en compra
- `generate_cashback.php` - Generar cashback autom√°tico (trigger)

**Sistema de √ìrdenes**:
- `get_user_tuu_orders.php` - Obtener pedidos y calcular puntos/sellos
- Campo `reward_stamps_consumed` en `tuu_orders` para tracking

### Flujo de Usuario

**1. Acumular Puntos**
- Usuario compra en la app
- Sistema calcula: monto / 10 = puntos
- Cada 1.000 puntos = 1 sello

**2. Ver Recompensas (ProfileModalModern)**
- Muestra puntos, sellos y nivel actual
- Botones "Canjear" son informativos
- Explican c√≥mo usar recompensas en checkout

**3. Aplicar Recompensas (CheckoutApp)**
- Checkout verifica sellos disponibles
- Muestra premios seg√∫n sellos (2 o 4)
- Usuario aplica premio ‚Üí se crea cup√≥n
- Descuento/productos gratis se aplican

**4. Completar Compra**
- Al pagar, cup√≥n se marca como usado
- Sistema verifica si complet√≥ nivel
- Genera cashback autom√°tico si aplica

### Caracter√≠sticas T√©cnicas
- **Triggers MySQL**: Generan cashback autom√°tico al completar niveles
- **C√°lculo Din√°mico**: Puntos y sellos se calculan en tiempo real
- **Sin Expiraci√≥n**: Cupones no expiran
- **Acumulables**: Usuario puede tener m√∫ltiples cupones
- **Integraci√≥n Checkout**: CheckoutApp.jsx maneja aplicaci√≥n de recompensas

### Documentaci√≥n Completa
Ver `SISTEMA_NIVELES_PREMIOS.md` para detalles t√©cnicos completos

---

## üìö Documentaci√≥n del Sistema de Cashback

### Estado Actual
- ‚úÖ **Backend**: 100% implementado y funcional
- ‚ùå **Frontend**: 0% implementado (pendiente)
- ‚è±Ô∏è **Tiempo estimado**: 1.5 horas para completar

### Documentos Disponibles

#### **INDICE_CASHBACK.md** üìö
**Documento maestro** con √≠ndice de toda la documentaci√≥n
- Gu√≠a r√°pida de qu√© documento leer seg√∫n tu necesidad
- Estado visual del proyecto
- Pr√≥ximos pasos priorizados
- Testing r√°pido

#### **ANALISIS_CASHBACK_COMPLETO.md** üîç
**An√°lisis t√©cnico detallado** del sistema completo
- Estado de base de datos y tablas
- An√°lisis de APIs disponibles
- Problemas cr√≠ticos detectados
- Plan de acci√≥n inmediato
- Consultas SQL √∫tiles

#### **CASHBACK_WALLET_ESTADO_ACTUAL.md** üìä
**Documentaci√≥n t√©cnica completa** del sistema
- Estructura de base de datos
- Sistema de niveles (Bronze, Silver, Gold)
- APIs implementadas con ejemplos
- Flujo completo del sistema
- Integraci√≥n con frontend
- Ejemplos de desglose en checkout

#### **CASHBACK_RESUMEN_RAPIDO.md** ‚ö°
**Gu√≠a r√°pida de implementaci√≥n** (30 minutos)
- Lo que funciona vs lo que falta
- C√≥digo listo para copiar/pegar
- Implementaci√≥n m√≠nima paso a paso
- Prioridades claras

### Sistema de Cashback

**Conversi√≥n de Puntos**:
```
$10 gastados = 1 punto
1.000 puntos = 1 sello
```

**Niveles y Cashback** (1% de retorno):
- ü•â **Bronze**: 6 sellos ($600.000) ‚Üí $6.000 cashback
- ü•à **Silver**: 12 sellos ($1.200.000) ‚Üí $12.000 cashback
- ü•á **Gold**: 18 sellos ($1.800.000) ‚Üí $18.000 cashback

**APIs Disponibles**:
- `get_wallet_balance.php` ‚Üí Obtener saldo y transacciones ‚úÖ
- `use_wallet_balance.php` ‚Üí Descontar cashback usado ‚úÖ
- `generate_cashback.php` ‚Üí Generar cashback por niveles ‚úÖ

**Pendiente de Implementaci√≥n**:
1. Llamar `generate_cashback.php` despu√©s de cada compra
2. UI para aplicar cashback en CheckoutApp.jsx
3. Visualizaci√≥n de saldo en ProfileModalModern.jsx
4. Notificaciones cuando se gana cashback

### Inicio R√°pido

**Para desarrolladores**:
1. Lee `INDICE_CASHBACK.md` para orientarte
2. Lee `CASHBACK_RESUMEN_RAPIDO.md` para implementar r√°pido
3. Copia el c√≥digo de ejemplo y adapta

**Para product owners**:
1. Lee `INDICE_CASHBACK.md` (secci√≥n "Estado Actual")
2. Revisa `CASHBACK_RESUMEN_RAPIDO.md` (secci√≥n "Lo que falta")

**Para QA/testers**:
1. Lee `ANALISIS_CASHBACK_COMPLETO.md` (secci√≥n "Consultas SQL")
2. Usa los comandos de testing en `INDICE_CASHBACK.md`

