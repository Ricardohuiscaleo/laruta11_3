---
// Keys - Gesti√≥n segura de API Keys
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keys - Admin La Ruta 11</title>
    <style>
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-white { background-color: #ffffff; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-orange-500 { background-color: #f97316; }
        .bg-orange-600 { background-color: #ea580c; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-gray-500 { background-color: #6b7280; }
        .bg-gray-600 { background-color: #4b5563; }
        .bg-gray-700 { background-color: #374151; }
        .text-white { color: #ffffff; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-900 { color: #111827; }
        .text-red-600 { color: #dc2626; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 500; }
        .font-mono { font-family: monospace; }
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .text-center { text-align: center; }
        .w-full { width: 100%; }
        .w-16 { width: 4rem; }
        .h-16 { height: 4rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-7xl { max-width: 80rem; }
        .max-w-xs { max-width: 20rem; }
        .mx-auto { margin: 0 auto; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mr-2 { margin-right: 0.5rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding: 0 0.5rem; }
        .px-3 { padding: 0 0.75rem; }
        .px-4 { padding: 0 1rem; }
        .px-6 { padding: 0 1.5rem; }
        .py-1 { padding: 0.25rem 0; }
        .py-2 { padding: 0.5rem 0; }
        .py-3 { padding: 0.75rem 0; }
        .py-4 { padding: 1rem 0; }
        .py-10 { padding: 2.5rem 0; }
        .pb-2 { padding-bottom: 0.5rem; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .border { border: 1px solid; }
        .border-b-2 { border-bottom: 2px solid; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-blue-500 { border-color: #3b82f6; }
        .shadow { box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .shadow-lg { box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .shadow-xl { box-shadow: 0 20px 25px rgba(0,0,0,0.1); }
        .overflow-hidden { overflow: hidden; }
        .overflow-x-auto { overflow-x: auto; }
        .min-w-full { min-width: 100%; }
        .divide-y > * + * { border-top: 1px solid; }
        .divide-gray-200 > * + * { border-color: #e5e7eb; }
        .uppercase { text-transform: uppercase; }
        .tracking-wider { letter-spacing: 0.05em; }
        .whitespace-nowrap { white-space: nowrap; }
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .blur-sm { filter: blur(4px); }
        .block { display: block; }
        .inline-block { display: inline-block; }
        .transition-colors { transition: color 0.15s, background-color 0.15s; }
        .focus\:outline-none:focus { outline: none; }
        .focus\:border-orange-500:focus { border-color: #f97316; }
        .hover\:bg-orange-600:hover { background-color: #ea580c; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-600:hover { background-color: #4b5563; }
        .hover\:bg-gray-700:hover { background-color: #374151; }
    </style>
    <link rel="icon" type="image/png" href="https://laruta11-images.s3.amazonaws.com/menu/logo.png" />
</head>
<body class="bg-gray-100">
    <div id="login-section">
        <div class="min-h-screen flex items-center justify-center">
            <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-md">
                <div class="text-center mb-6">
                    <img src="https://laruta11-images.s3.amazonaws.com/menu/logo.png" alt="La Ruta 11" class="w-16 h-16 mx-auto mb-4">
                    <h1 class="text-2xl font-bold text-gray-800">üîê Acceso a Keys</h1>
                    <p class="text-gray-600">Ingresa tus credenciales admin</p>
                </div>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Usuario Admin</label>
                        <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Contrase√±a</label>
                        <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" required>
                    </div>
                    <button type="submit" class="w-full bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 transition-colors font-bold">Acceder</button>
                    <div id="error" class="text-red-600 text-sm text-center mt-4" style="display: none;"></div>
                </form>
            </div>
        </div>
    </div>

    <div id="keys-section" style="display: none;">
        <div class="max-w-7xl mx-auto p-6">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <a href="/admin" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors inline-block mb-4">‚Üê Volver al Admin</a>
                <h1 class="text-3xl font-bold text-gray-800">üîë Gesti√≥n de API Keys</h1>
                <p class="text-gray-600 mt-2">Administraci√≥n segura de claves de API y configuraciones</p>
            </div>
            
            <div id="keys-container">
                <div class="text-center py-10 text-gray-600">Cargando keys...</div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = (document.getElementById('username') as HTMLInputElement)?.value;
            const password = (document.getElementById('password') as HTMLInputElement)?.value;
            const errorDiv = document.getElementById('error');
            
            if (!username || !password || !errorDiv) return;
            
            try {
                const response = await fetch('/api/admin/verify_keys_access.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const loginSection = document.getElementById('login-section');
                    const keysSection = document.getElementById('keys-section');
                    if (loginSection) loginSection.style.display = 'none';
                    if (keysSection) keysSection.style.display = 'block';
                    loadKeys();
                } else {
                    errorDiv.textContent = data.message;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'Error de conexi√≥n';
                errorDiv.style.display = 'block';
            }
        });

        async function loadKeys() {
            try {
                const response = await fetch('/api/admin/get_keys.php');
                const data = await response.json();
                
                if (data.success) {
                    renderKeys(data.keys);
                }
            } catch (error) {
                console.error('Error cargando keys:', error);
            }
        }

        function renderKeys(keys: any) {
            const container = document.getElementById('keys-container');
            if (!container) return;
            
            let html = '<div class="bg-white rounded-lg shadow overflow-hidden"><table class="min-w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Key</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">';
            
            Object.entries(keys).forEach(([keyName, value]: [string, any]) => {
                const displayValue = typeof value === 'object' ? JSON.stringify(value) : String(value);
                html += `<tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${keyName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div class="key-value blur-sm font-mono bg-gray-50 px-2 py-1 rounded text-xs max-w-xs overflow-hidden" id="key-${keyName}">${displayValue}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs mr-2" onclick="toggleKey('${keyName}')">üëÅÔ∏è Mostrar</button>
                        <button class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs" onclick="copyKey('${keyName}')">üìã Copiar</button>
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Make functions globally accessible
        (window as any).toggleKey = function(keyName: string) {
            const keyElement = document.getElementById(`key-${keyName}`);
            const button = (event as any)?.target as HTMLButtonElement;
            
            if (keyElement && button) {
                if (keyElement.classList.contains('blur-sm')) {
                    keyElement.classList.remove('blur-sm');
                    button.textContent = 'üôà Ocultar';
                    button.className = 'bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-xs mr-2';
                } else {
                    keyElement.classList.add('blur-sm');
                    button.textContent = 'üëÅÔ∏è Mostrar';
                    button.className = 'bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs mr-2';
                }
            }
        };

        (window as any).copyKey = function(keyName: string) {
            const keyElement = document.getElementById(`key-${keyName}`);
            if (keyElement?.textContent) {
                navigator.clipboard.writeText(keyElement.textContent).then(() => {
                    const button = (event as any)?.target as HTMLButtonElement;
                    if (button) {
                        const originalText = button.textContent;
                        button.textContent = '‚úÖ Copiado';
                        setTimeout(() => {
                            button.textContent = originalText;
                        }, 2000);
                    }
                });
            }
        };

        loadKeys();
    </script>
</body>
</html>