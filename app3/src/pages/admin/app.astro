---
---
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics App - Admin La Ruta 11</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f8fafc; }
    .header { background: white; padding: 1.5rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .back-btn { background: #667eea; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; text-decoration: none; }
    .container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
    .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
    .metric-card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); text-align: center; }
    .metric-value { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; }
    .metric-label { color: #6b7280; font-size: 0.875rem; }
    .metric-icon { margin-bottom: 1rem; }
    .green { color: #059669; }
    .blue { color: #3b82f6; }
    .purple { color: #7c3aed; }
    .orange { color: #ea580c; }
    .red { color: #dc2626; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 1.5rem; }
    .card-header { padding: 1.5rem 2rem; border-bottom: 1px solid #e5e7eb; }
    .card-content { padding: 2rem; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìä Analytics de la App</h1>
    <a href="/admin" class="back-btn">‚Üê Volver al Admin</a>
  </div>
  
  <div class="container">
    <div class="metrics">
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
        <div class="metric-value blue" id="visits-today">0</div>
        <div class="metric-label">Visitas Hoy</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
        <div class="metric-value green" id="visits-week">0</div>
        <div class="metric-label">Visitas Semana</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
        <div class="metric-value purple" id="visits-month">0</div>
        <div class="metric-label">Visitas Mes</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="m22 21-3-3m0 0a5.5 5.5 0 1 0-7.78 0L14 18l3 3Z"/></svg>
        <div class="metric-value orange" id="total-users">0</div>
        <div class="metric-label">Usuarios Registrados</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 11l-3-3m0 0a5.5 5.5 0 1 0-7.78 0L14 8l3 3Z"/></svg>
        <div class="metric-value green" id="new-users">0</div>
        <div class="metric-label">Nuevos Usuarios Hoy</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v5h5"/><path d="M6 17l4-4 4 4 6-6"/><path d="M18 7h3v5"/></svg>
        <div class="metric-value red" id="revenue-today">$0</div>
        <div class="metric-label">Ingresos Hoy</div>
      </div>
    </div>
    
    <div class="grid-2">
      <div class="card">
        <div class="card-header">
          <h3>üì± Informaci√≥n de la App</h3>
        </div>
        <div class="card-content">
          <div style="display: grid; gap: 1rem;">
            <div style="display: flex; justify-content: space-between;">
              <span>URL Principal:</span>
              <strong>https://app.laruta11.cl</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Total Productos:</span>
              <strong id="total-products">0</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Pedidos Hoy:</span>
              <strong id="orders-today">0</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Estado:</span>
              <span style="color: #059669; font-weight: 600;">üü¢ Activa</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3>üéØ M√©tricas Clave</h3>
        </div>
        <div class="card-content">
          <div style="display: grid; gap: 1rem;">
            <div style="display: flex; justify-content: space-between;">
              <span>Conversi√≥n Visitas ‚Üí Registro:</span>
              <strong id="conversion-rate">0%</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Promedio Pedidos/Usuario:</span>
              <strong id="avg-orders">0</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Ticket Promedio:</span>
              <strong id="avg-ticket">$0</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Usuarios Activos:</span>
              <strong id="active-users">0</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h3>üìà Resumen de Actividad</h3>
      </div>
      <div class="card-content">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;" id="peak-hour">--:--</div>
            <div style="font-size: 0.875rem; color: #6b7280;">Hora Pico</div>
          </div>
          <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700; color: #059669;" id="bounce-rate">0%</div>
            <div style="font-size: 0.875rem; color: #6b7280;">Tasa de Rebote</div>
          </div>
          <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700; color: #7c3aed;" id="session-duration">0min</div>
            <div style="font-size: 0.875rem; color: #6b7280;">Duraci√≥n Promedio</div>
          </div>
          <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700; color: #ea580c;" id="return-rate">0%</div>
            <div style="font-size: 0.875rem; color: #6b7280;">Usuarios Recurrentes</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    function loadAnalytics() {
      fetch('/api/app/get_analytics.php')
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            // M√©tricas principales
            const visitsToday = document.getElementById('visits-today'); if (visitsToday) visitsToday.textContent = data.data.visitors.today;
            const visitsWeek = document.getElementById('visits-week'); if (visitsWeek) visitsWeek.textContent = data.data.visitors.week;
            const visitsMonth = document.getElementById('visits-month'); if (visitsMonth) visitsMonth.textContent = data.data.visitors.month;
            const totalUsers = document.getElementById('total-users'); if (totalUsers) totalUsers.textContent = data.data.users.total;
            const newUsers = document.getElementById('new-users'); if (newUsers) newUsers.textContent = data.data.users.new_today;
            const revenueToday = document.getElementById('revenue-today'); if (revenueToday) revenueToday.textContent = '$' + data.data.sales.revenue_today.toLocaleString('es-CL');
            
            // Informaci√≥n adicional
            const totalProducts = document.getElementById('total-products'); if (totalProducts) totalProducts.textContent = data.data.products.total;
            const ordersToday = document.getElementById('orders-today'); if (ordersToday) ordersToday.textContent = data.data.sales.orders_today;
            
            // Calcular m√©tricas derivadas
            const conversionRate = data.data.visitors.month > 0 ? ((data.data.users.total / data.data.visitors.month) * 100).toFixed(1) : '0';
            const conversionEl = document.getElementById('conversion-rate'); if (conversionEl) conversionEl.textContent = conversionRate + '%';
            
            const avgOrders = data.data.users.total > 0 ? (data.data.sales.orders_today / data.data.users.total).toFixed(1) : '0';
            const avgOrdersEl = document.getElementById('avg-orders'); if (avgOrdersEl) avgOrdersEl.textContent = avgOrders;
            
            const avgTicket = data.data.sales.orders_today > 0 ? (data.data.sales.revenue_today / data.data.sales.orders_today).toLocaleString('es-CL') : '0';
            const avgTicketEl = document.getElementById('avg-ticket'); if (avgTicketEl) avgTicketEl.textContent = '$' + avgTicket;
            
            const activeUsers = document.getElementById('active-users'); if (activeUsers) activeUsers.textContent = data.data.users.total;
            
            // M√©tricas simuladas (en una implementaci√≥n real vendr√≠an de la API)
            const peakHour = document.getElementById('peak-hour'); if (peakHour) peakHour.textContent = '19:30';
            const bounceRate = document.getElementById('bounce-rate'); if (bounceRate) bounceRate.textContent = '23%';
            const sessionDuration = document.getElementById('session-duration'); if (sessionDuration) sessionDuration.textContent = '4.2min';
            const returnRate = document.getElementById('return-rate'); if (returnRate) returnRate.textContent = '67%';
          }
        })
        .catch(error => {
          console.error('Error cargando analytics:', error);
        });
    }
    
    // Verificar auth y cargar analytics
    fetch('/api/check_admin_auth.php')
      .then(r => r.json())
      .then(data => {
        if (!data.authenticated) window.location.href = '/admin/login';
        else loadAnalytics();
      });
    
    // Auto-refresh cada 30 segundos
    setInterval(loadAnalytics, 30000);
  </script>
</body>
</html>