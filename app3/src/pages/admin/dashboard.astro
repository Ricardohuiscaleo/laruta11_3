<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - La Ruta 11</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: #f8fafc;
      min-height: 100vh;
    }
    .header { 
      background: white; 
      padding: 1.5rem 2rem; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .back-btn { 
      background: #667eea; 
      color: white; 
      border: none; 
      padding: 0.75rem 1.5rem; 
      border-radius: 8px; 
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .back-btn:hover { background: #5a67d8; }
    .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
    .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
    .metric-card { 
      background: white; 
      padding: 2rem; 
      border-radius: 12px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      text-align: center;
    }
    .metric-icon { margin-bottom: 1rem; }
    h1 { display: flex; align-items: center; gap: 12px; }
    .header-icon { flex-shrink: 0; }
    .metric-value { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; }
    .metric-label { color: #718096; font-size: 0.9rem; }
    .green { color: #38a169; }
    .blue { color: #3182ce; }
    .purple { color: #805ad5; }
    .orange { color: #dd6b20; }
    .metrics { margin-bottom: 2rem; }
    .metric-card { position: relative; }
    .metric-card:hover { transform: translateY(-2px); transition: transform 0.2s; }
  </style>
</head>
<body>
  <div class="header">
    <h1><svg class="header-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v5h5"/><path d="M6 17l4-4 4 4 6-6"/><path d="M18 7h3v5"/></svg> Dashboard</h1>
    <a href="/admin" class="back-btn">‚Üê Volver</a>
  </div>
  
  <div class="container">
    <!-- M√©tricas principales -->
    <div class="metrics">
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v5h5"/><path d="M6 17l4-4 4 4 6-6"/><path d="M18 7h3v5"/></svg>
        <div class="metric-value green" id="sales">$0</div>
        <div class="metric-label">Ventas Hoy</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3h5v5"/><path d="M8 3H3v5"/><path d="M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3"/><path d="m15 9 6 6"/><path d="M9 9 3 3"/></svg>
        <div class="metric-value blue" id="orders">0</div>
        <div class="metric-label">√ìrdenes</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M5 10v2a7 7 0 0 0 14 0v-2"/><path d="M15 7v5a3 3 0 0 1-6 0v-5"/></svg>
        <div class="metric-value purple" id="products">0</div>
        <div class="metric-label">Productos</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
        <div class="metric-value orange" id="pending">0</div>
        <div class="metric-label">Visitas Hoy</div>
      </div>
    </div>
    
    <!-- M√©tricas de comportamiento -->
    <div class="metrics">
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        <div class="metric-value" style="color: #f59e0b;" id="interactions">0</div>
        <div class="metric-label">Interacciones</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        <div class="metric-value" style="color: #10b981;" id="avg-time">0s</div>
        <div class="metric-label">Tiempo Promedio</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        <div class="metric-value" style="color: #8b5cf6;" id="top-product">-</div>
        <div class="metric-label">Producto Top</div>
      </div>
      
      <div class="metric-card">
        <svg class="metric-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v5h5"/><path d="M6 17l4-4 4 4 6-6"/><path d="M18 7h3v5"/></svg>
        <div class="metric-value" style="color: #8b5cf6; font-size: 1.5rem;">üìä</div>
        <div class="metric-label">Analytics</div>
        <a href="/admin/analytics" class="back-btn" style="margin-top: 1rem; font-size: 0.8rem; padding: 0.5rem 1rem;">Ver Detalles</a>
      </div>
    </div>
    
    <!-- Secci√≥n Robots -->
    <div style="margin-top: 3rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold; color: #374151; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
        ü§ñ Robots de Testing
      </h2>
      <div class="metrics">
        <div class="metric-card" style="text-align: left;">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <div style="font-size: 2rem;">ü§ñ</div>
            <div>
              <h3 style="font-size: 1.1rem; font-weight: bold; color: #374151; margin-bottom: 0.25rem;">Robot Test Tracking</h3>
              <p style="color: #6b7280; font-size: 0.9rem;">Simula usuario real y verifica que el tracking funcione</p>
            </div>
          </div>
          <div style="display: flex; gap: 0.75rem;">
            <a href="/api/robot_test_tracking.php" target="_blank" class="back-btn" style="margin: 0; font-size: 0.8rem; padding: 0.5rem 1rem; background: #10b981;">üöÄ Ejecutar Robot</a>
            <button onclick="window.open('/api/robot_test_tracking.php', '_blank')" class="back-btn" style="margin: 0; font-size: 0.8rem; padding: 0.5rem 1rem; background: #6b7280;">üìä Ver Estado</button>
          </div>
        </div>
        
        <div class="metric-card" style="text-align: left;">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <div style="font-size: 2rem;">üìä</div>
            <div>
              <h3 style="font-size: 1.1rem; font-weight: bold; color: #374151; margin-bottom: 0.25rem;">Test APIs</h3>
              <p style="color: #6b7280; font-size: 0.9rem;">Prueba individual de cada API de tracking</p>
            </div>
          </div>
          <div style="display: flex; gap: 0.75rem;">
            <a href="/api/test_analytics_system.php" target="_blank" class="back-btn" style="margin: 0; font-size: 0.8rem; padding: 0.5rem 1rem; background: #3b82f6;">üß™ Test APIs</a>
            <a href="/api/check_tracking_data.php" target="_blank" class="back-btn" style="margin: 0; font-size: 0.8rem; padding: 0.5rem 1rem; background: #8b5cf6;">üìã Ver Datos</a>
          </div>
        </div>
        
        <div class="metric-card" style="text-align: left;">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <div style="font-size: 2rem;">‚öôÔ∏è</div>
            <div>
              <h3 style="font-size: 1.1rem; font-weight: bold; color: #374151; margin-bottom: 0.25rem;">Configuraci√≥n</h3>
              <p style="color: #6b7280; font-size: 0.9rem;">Verificar tablas y estructura de base de datos</p>
            </div>
          </div>
          <div style="display: flex; gap: 0.75rem;">
            <a href="/api/check_visits_table.php" target="_blank" class="back-btn" style="margin: 0; font-size: 0.8rem; padding: 0.5rem 1rem; background: #f59e0b;">üóÑÔ∏è Ver Tablas</a>
            <a href="/api/update_visits_table.php" target="_blank" class="back-btn" style="margin: 0; font-size: 0.8rem; padding: 0.5rem 1rem; background: #ef4444;">üîß Actualizar</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Verificar auth
    fetch('/api/check_admin_auth.php')
      .then(r => r.json())
      .then(data => {
        if (!data.authenticated) window.location.href = '/admin/login';
      });
    
    // Cargar m√©tricas b√°sicas
    fetch('/api/app/get_analytics.php')
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          const salesEl = document.getElementById('sales');
          const ordersEl = document.getElementById('orders');
          const productsEl = document.getElementById('products');
          const pendingEl = document.getElementById('pending');
          
          if (salesEl) salesEl.textContent = `$${data.data.sales.revenue_today.toLocaleString()}`;
          if (ordersEl) ordersEl.textContent = data.data.sales.orders_today;
          if (productsEl) productsEl.textContent = data.data.products.total;
          if (pendingEl) pendingEl.textContent = data.data.visitors.today;
        }
      })
      .catch(console.error);
    
    // Cargar m√©tricas de comportamiento
    fetch('/api/app/get_user_behavior.php')
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          // Total interacciones
          const totalInteractions = data.data.interactions_today.reduce((sum, item) => sum + parseInt(item.count), 0);
          const interactionsEl = document.getElementById('interactions');
          if (interactionsEl) interactionsEl.textContent = totalInteractions;
          
          // Tiempo promedio
          const avgTime = data.data.engagement?.avg_time ? Math.round(data.data.engagement.avg_time) : 0;
          const avgTimeEl = document.getElementById('avg-time');
          if (avgTimeEl) avgTimeEl.textContent = avgTime + 's';
          
          // Producto m√°s popular
          const topProduct = data.data.top_products[0];
          const topProductEl = document.getElementById('top-product');
          if (topProduct && topProductEl) {
            const productName = topProduct.product_name.length > 15 
              ? topProduct.product_name.substring(0, 15) + '...' 
              : topProduct.product_name;
            topProductEl.textContent = productName;
          }
        }
      })
      .catch(console.error);
  </script>
</body>
</html>